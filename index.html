<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <title>Professional Productivity Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
  <style>
    /* ------------ Core Design & Variables ---------------- */
    :root {
      --primary: #5A67D8; /* Professional Blue */
      --secondary: #48BB78; /* Green for success/focus */
      --background: #F8F9FA; /* Light Grey Background */
      --surface: #FFFFFF; /* White Cards/Surfaces */
      --text-main: #2D3748; /* Dark Grey Text */
      --text-soft: #718096; /* Medium Grey Text */
      --border-color: #E2E8F0;
      --shadow-sm: 0 1px 3px 0 rgba(0, 0, 0, 0.08), 0 1px 2px 0 rgba(0, 0, 0, 0.03);
      --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
      --danger: #E53E3E;
    }
    [data-theme="dark"] {
      --primary: #63B3ED;
      --secondary: #68D391;
      --background: #1A202C; /* Dark Background */
      --surface: #2D3748; /* Darker Cards */
      --text-main: #EDF2F7; /* Light Text */
      --text-soft: #A0AEC0;
      --border-color: #4A5568;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0; padding: 0; font-family: 'Inter', sans-serif;
      background: var(--background); color: var(--text-main);
      min-height: 100vh; transition: background .3s, color .3s;
      line-height: 1.6;
    }

    /* Typography */
    h1, h2, h3 { color: var(--text-main); font-weight: 700; margin-top: 0; }
    h2 { font-size: 1.5rem; border-bottom: 2px solid var(--border-color); padding-bottom: 0.5em; margin-bottom: 1em; }
    [data-theme="dark"] h2 { border-color: #4A5568; }

    /* Buttons */
    button {
      background: var(--primary); color: var(--surface); border: none; border-radius: 6px;
      padding: 0.6em 1.2em; font-size: 0.95rem; cursor: pointer; transition: all .2s;
      font-weight: 600;
    }
    button:hover { background: color-mix(in srgb, var(--primary) 90%, black); }
    button.alt { background: var(--text-soft); }
    button.alt:hover { background: color-mix(in srgb, var(--text-soft) 90%, black); }
    button.icon-only { padding: 0.4em 0.8em; }

    /* Forms */
    input[type="text"], input[type="number"], select {
      padding: 0.75em 1em; border-radius: 6px; border: 1px solid var(--border-color);
      background: var(--surface); color: var(--text-main); transition: border-color .2s;
    }
    input:focus, select:focus { border-color: var(--primary); outline: none; box-shadow: 0 0 0 3px rgba(90, 103, 216, 0.1); }

    /* Layout */
    .dashboard-header {
      background: var(--primary); color: #fff; padding: 3rem 4vw 2rem 4vw;
      text-align: center; border-bottom: 5px solid color-mix(in srgb, var(--primary) 80%, black);
    }
    .quote { font-style: italic; font-size: 1.1rem; opacity: 0.9; margin-bottom: 1rem; }

    .sidebar {
      position: fixed; left: 0; top: 0; width: 75px; height: 100vh;
      background: var(--surface); z-index: 10; padding-top: 2rem;
      box-shadow: var(--shadow-lg); display: flex; flex-direction: column;
      align-items: center; gap: 1.5em; transition: background .3s, width .3s;
    }
    .sidebar button {
      background: none; border: none; color: var(--text-soft); font-size: 1.5rem;
      cursor: pointer; padding: 1em 0; transition: color .2s;
      width: 100%; border-left: 4px solid transparent;
    }
    .sidebar button.active, .sidebar button:hover {
      color: var(--primary); border-left: 4px solid var(--primary);
      background: color-mix(in srgb, var(--primary) 5%, var(--surface));
    }
    [data-theme="dark"] .sidebar button.active { border-left-color: var(--primary); }

    main {
      margin-left: 75px; padding: 2.5em 4vw; max-width: 1300px; transition: margin-left .3s;
    }
    .grid-layout {
      display: grid; gap: 1.8rem;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    }
    .flex-col { display: flex; flex-direction: column; gap: 1.2rem; }

    .section { display: none; animation: fadeIn .5s; }
    .section.active { display: block; }
    @keyframes fadeIn { from{opacity:0;transform:translateY(10px);} to{opacity:1;transform:translateY(0);}}

    /* Widgets */
    .widget {
      background: var(--surface); border-radius: 12px; box-shadow: var(--shadow-sm);
      padding: 1.5em; transition: background .3s, box-shadow .2s;
    }

    /* Badges/Tags */
    .badges { display: flex; justify-content: center; gap: 0.7em; margin-top: 1rem; }
    .badge {
      background: var(--secondary); color: var(--surface); border-radius: 8px; font-weight: 600;
      padding: 0.4em 0.8em; font-size: 0.85rem; box-shadow: var(--shadow-sm);
    }
    [data-theme="dark"] .badge { background: var(--secondary); color: var(--text-main); }

    /* Clock & Weather */
    .clock-weather-container { display: flex; align-items: center; justify-content: space-between; margin-bottom: 1.2em; }
    #clockDisplay {
      font-size: 3rem; font-weight: 800; color: var(--primary); letter-spacing: -1px;
    }
    #analogClock { border: 2px solid var(--primary); border-radius: 50%; }
    .clock-controls { margin-top: 0.5em; }
    .clock-controls button { background: none; color: var(--primary); border: 1px solid var(--primary); padding: 0.4em 1em; font-size: 0.85rem; }
    .clock-controls button:hover { background: color-mix(in srgb, var(--primary) 10%, var(--surface)); }
    #weatherWidget {
      background: color-mix(in srgb, var(--primary) 10%, var(--surface)); border-radius: 8px;
      display: flex; flex-direction: column; align-items: center; padding: 0.8em 1em;
      min-width: 110px; font-weight: 600;
    }
    .weather-icon { font-size: 2.5rem; margin-bottom: 0.2em; }
    [data-theme="dark"] #weatherWidget { background: #4A5568; }

    /* Quicklinks */
    .quicklinks-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 0.8em; margin-top: 1.5em; }
    .quicklink {
      background: color-mix(in srgb, var(--primary) 10%, var(--surface)); color: var(--primary);
      border-radius: 6px; padding: 0.6em 1em; text-decoration: none; font-weight: 600;
      text-align: center; transition: background .2s, transform .1s;
    }
    .quicklink:hover { background: color-mix(in srgb, var(--primary) 20%, var(--surface)); transform: translateY(-1px); }
    [data-theme="dark"] .quicklink { background: #4A5568; color: var(--primary); }

    /* Pomodoro */
    #pomodoroDisplay {
      font-size: 3.5rem; font-weight: 800; text-align: center; margin: 0.5em 0 0.8em 0;
      color: var(--primary); letter-spacing: 2px;
    }
    .pomodoro-controls { text-align: center; margin-bottom: 1em; }
    .pomodoro-controls button { margin: 0 0.4em; }
    .pomodoro-settings { display: flex; justify-content: center; gap: 2em; margin-top: 1em; font-size: 0.95rem; }
    .pomodoro-settings input { width: 40px; text-align: center; margin-right: 0.3em; }
    .analytics-bar {
      height: 10px; background: var(--border-color); border-radius: 5px; margin-top: 1.5em; overflow: hidden;
    }
    .analytics-fill { height: 100%; background: var(--primary); width: 0; transition: width .5s; }
    #pomStats { text-align: center; color: var(--text-soft); margin-top: 1em; font-weight: 500; }

    /* Planner/ToDo */
    .planner-action-bar { display: flex; gap: 0.7em; margin-bottom: 1em; }
    .planner-action-bar input { flex-grow: 1; }
    .planner-action-bar select { min-width: 100px; }
    .planner-list { list-style: none; padding: 0; }
    .planner-task {
      background: color-mix(in srgb, var(--secondary) 10%, var(--surface)); border-radius: 8px;
      padding: 0.9em 1.2em; margin-bottom: 0.7em; font-size: 1rem; color: var(--text-main);
      display: flex; align-items: center; justify-content: space-between;
      box-shadow: var(--shadow-sm); transition: all .2s;
    }
    .planner-task:hover { box-shadow: var(--shadow-lg); }
    .planner-task.completed { opacity: 0.6; text-decoration: line-through; background: color-mix(in srgb, var(--text-soft) 10%, var(--surface)); }
    .planner-task .drag-handle { cursor: grab; font-size: 1.2em; margin-right: 0.8em; color: var(--primary); }
    .planner-task .delete { background: var(--danger); }
    .planner-task .delete:hover { background: color-mix(in srgb, var(--danger) 90%, black); }
    .task-content { flex-grow: 1; display: flex; align-items: center; }
    .task-content small { font-weight: 500; color: var(--primary); margin-left: 0.6em; }

    /* Notes/Sticky */
    .notes-action-bar { display: flex; gap: 0.7em; margin-bottom: 1em; }
    .notes-action-bar input { flex-grow: 1; }
    .notes-list { list-style: none; padding: 0; display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 1rem; }
    .note {
      background: color-mix(in srgb, var(--primary) 5%, var(--surface)); border-radius: 8px;
      padding: 1em; box-shadow: var(--shadow-sm); position: relative;
      word-break: break-word; min-height: 120px;
    }
    .note .note-title { font-weight: 700; margin-bottom: 0.3em; display: block; color: var(--primary); }
    .note .note-content { display: block; font-size: 0.95rem; color: var(--text-soft); }
    .note button { background: var(--danger); padding: 0.3em 0.6em; border-radius: 4px; position: absolute; top: 8px; right: 8px; }
    .note button:hover { background: color-mix(in srgb, var(--danger) 90%, black); }

    /* Calendar */
    .calendar-widget { background: var(--surface); padding: 1em; border-radius: 12px; max-width: 350px; }
    .calendar-head { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1em; }
    .calendar-head button { background: none; border: none; font-size: 1.4rem; color: var(--primary); padding: 0.2em 0.5em; }
    .calendar-table { border-collapse: collapse; width: 100%; font-size: 0.95rem; }
    .calendar-table th, .calendar-table td {
      text-align: center; padding: 0.4em; border-radius: 5px; width: 40px; height: 40px;
    }
    .calendar-table th { color: var(--text-soft); font-weight: 600; }
    .calendar-table td.today { background: var(--primary); color: #fff; font-weight: bold; }
    .calendar-table td:hover { background: color-mix(in srgb, var(--primary) 10%, var(--surface)); cursor: pointer; }
    .calendar-table td.today:hover { background: var(--primary); }

    /* Analytics */
    .analytics-row { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1.2rem; margin-top: 1.5em; }
    .analytics-card {
      background: color-mix(in srgb, var(--secondary) 10%, var(--surface)); border-radius: 8px;
      padding: 1.2em; font-weight: 700; color: var(--primary); text-align: center;
      box-shadow: var(--shadow-sm);
    }
    [data-theme="dark"] .analytics-card { background: #4A5568; color: var(--primary); }
    .analytics-card span { display: block; font-size: 0.9rem; font-weight: 500; color: var(--text-soft); margin-top: 0.3em; }

    /* Theme Switcher */
    .theme-switcher {
      position: absolute; right: 4vw; top: 1.5rem;
      background: var(--surface); border-radius: 50%; width: 45px; height: 45px;
      border: 3px solid var(--primary); display: flex; align-items: center; justify-content: center;
      cursor: pointer; font-size: 1.5rem; color: var(--primary); box-shadow: var(--shadow-sm);
      transition: all .2s; z-index: 100;
    }
    .theme-switcher:hover { border-color: var(--secondary); transform: rotate(15deg); }
    [data-theme="dark"] .theme-switcher { background: var(--surface); color: var(--primary); border-color: var(--primary); }

    /* Music Bar */
    .musicbar { background: color-mix(in srgb, var(--primary) 5%, var(--surface)); padding: 0.8em; border-radius: 8px; margin-top: 1em; }
    .musicbar button { background: var(--secondary); margin-left: 0.5em; padding: 0.5em 1em; }
    .musicbar label { color: var(--text-soft); font-weight: 600; margin-right: 0.5em; }
    .musicbar select { padding: 0.5em; border: 1px solid var(--border-color); }

    /* Habit Tracker */
    .habit-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 1rem; }
    .habit-card {
      background: color-mix(in srgb, var(--secondary) 5%, var(--surface)); border-radius: 8px;
      padding: 1em; box-shadow: var(--shadow-sm);
    }
    .habit-card h4 { margin-bottom: 0.5em; color: var(--primary); font-size: 1rem; }
    .habit-card label { display: block; margin-top: 0.7em; font-size: 0.9rem; }
    .habit-card input[type="number"] { width: 55px; text-align: center; }

    /* Media Queries for Responsiveness */
    @media (max-width: 900px) {
      .sidebar { display: none; }
      main { margin-left: 0; padding: 1.5em; }
      .dashboard-header { padding: 2rem 1.5em; }
      .theme-switcher { right: 1.5em; top: 1em; }
      .grid-layout { grid-template-columns: 1fr; }
      .notes-list { grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); }
      .pomodoro-settings { flex-direction: column; align-items: center; }
      .pomodoro-settings > label { margin-bottom: 0.5em; }
    }
  </style>
</head>
<body>
  <div class="theme-switcher" id="themeSwitch" title="Toggle Theme">
    <i class="fas fa-moon"></i>
  </div>
  <header class="dashboard-header">
    <h1 id="greeting" style="font-size: 2.5rem;"></h1>
    <div class="quote" id="quoteOfDay"></div>
    <div class="badges" id="badgesBar"></div>
  </header>

  <nav class="sidebar">
    <button class="active" data-section="dashboard" title="Dashboard">
      <i class="fas fa-home"></i>
    </button>
    <button data-section="pomodoro" title="Pomodoro">
      <i class="fas fa-clock"></i>
    </button>
    <button data-section="planner" title="Planner">
      <i class="fas fa-clipboard-list"></i>
    </button>
    <button data-section="notes" title="Sticky Notes">
      <i class="fas fa-note-sticky"></i>
    </button>
    <button data-section="calendar" title="Calendar">
      <i class="fas fa-calendar-alt"></i>
    </button>
    <button data-section="analytics" title="Analytics">
      <i class="fas fa-chart-line"></i>
    </button>
  </nav>

  <main>
    <section id="dashboard" class="section active">
      <div class="grid-layout">
        <div class="widget flex-col">
          <div class="clock-weather-container">
            <div>
              <span id="clockDisplay"></span>
              <div class="clock-controls">
                <button onclick="toggleClock()" id="clockToggleButton">
                  <i class="fas fa-sync-alt"></i> Digital/Analog
                </button>
              </div>
            </div>
            <div id="weatherWidget">
              <span class="weather-icon" id="weatherIcon"><i class="fas fa-sun"></i></span>
              <span id="weatherInfo">Loading...</span>
            </div>
          </div>
          <canvas id="analogClock" width="106" height="106" style="display:none;margin: 1em auto;"></canvas>

          <div class="musicbar">
            <label for="musicSelect">Ambient Music:</label>
            <select id="musicSelect" onchange="updateMusicSource()">
              <option value="none">None</option>
              <option value="lofi">Lo-Fi Focus</option>
              <option value="rain">Rain Sounds</option>
              <option value="waves">Ocean Waves</option>
            </select>
            <button onclick="toggleMusic()" id="musicToggleBtn">
              <i class="fas fa-play"></i> Play
            </button>
            <audio id="musicAudio" loop></audio>
          </div>

          <div style="margin-top: 1.5em;">
            <h2>Quick Access</h2>
            <div class="quicklinks-grid">
              <a class="quicklink" href="https://www.habitica.com/" target="_blank">Habitica <i class="fas fa-external-link-alt" style="font-size: 0.7em;"></i></a>
              <a class="quicklink" href="https://leetcode.com/" target="_blank">LeetCode <i class="fas fa-external-link-alt" style="font-size: 0.7em;"></i></a>
              <a class="quicklink" href="https://github.com/" target="_blank">GitHub <i class="fas fa-external-link-alt" style="font-size: 0.7em;"></i></a>
              <a class="quicklink" href="https://www.geeksforgeeks.org/" target="_blank">GeeksforGeeks <i class="fas fa-external-link-alt" style="font-size: 0.7em;"></i></a>
            </div>
          </div>
        </div>

        <div class="widget">
          <h2>Habit Tracker & Streaks</h2>
          <div id="habitBar" class="habit-grid"></div>
        </div>
      </div>
    </section>

    <section id="pomodoro" class="section">
      <div class="widget">
        <h2>Pomodoro Timer</h2>
        <div id="pomodoroDisplay">25:00</div>
        <div class="pomodoro-controls">
          <button onclick="startPomodoro()" id="pomodoroStartBtn">
            <i class="fas fa-play"></i> Start
          </button>
          <button onclick="pausePomodoro()" id="pomodoroPauseBtn" class="alt">
            <i class="fas fa-pause"></i> Pause
          </button>
          <button onclick="resetPomodoro()" class="alt">
            <i class="fas fa-stop"></i> Reset
          </button>
        </div>
        <div class="pomodoro-settings">
          <label>
            <input type="number" id="studyTime" min="1" max="60" value="25" style="width:50px;"> min Focus
          </label>
          <label>
            <input type="number" id="shortBreak" min="1" max="15" value="5" style="width:50px;"> min Short Break
          </label>
          <label>
            <input type="number" id="longBreak" min="10" max="30" value="15" style="width:50px;"> min Long Break
          </label>
        </div>
        <div class="analytics-bar"><div class="analytics-fill" id="pomFill"></div></div>
        <p id="pomStats"></p>
      </div>
    </section>

    <section id="planner" class="section">
      <div class="widget">
        <h2>Daily & Weekly Planner</h2>
        <div class="planner-action-bar">
          <input type="text" id="plannerTaskInput" placeholder="Enter new task..." style="flex: 1;">
          <select id="plannerDaySelect">
            <option value="Today">Today</option>
            <option value="This Week">This Week</option>
            <option value="Next Week">Next Week</option>
          </select>
          <button onclick="addPlannerTask()" style="min-width: 80px;">
            <i class="fas fa-plus"></i> Add
          </button>
        </div>
        <ul class="planner-list" id="plannerList"></ul>
      </div>
    </section>

    <section id="notes" class="section">
      <div class="widget">
        <h2>Sticky Notes & Ideas</h2>
        <div class="notes-action-bar">
          <input id="noteTitleInput" type="text" placeholder="Title (Optional)..." style="width: 28%;">
          <input id="noteInput" type="text" placeholder="Note content..." style="width: 45%;">
          <button onclick="addNote()">
            <i class="fas fa-paper-plane"></i> Save
          </button>
        </div>
        <input type="text" placeholder="Search notes..." id="noteSearch" style="width: 100%; margin-bottom: 1em;">
        <ul class="notes-list" id="notesList"></ul>
      </div>
    </section>

    <section id="calendar" class="section">
      <div class="widget calendar-widget">
        <h2>Calendar View</h2>
        <div class="calendar-head">
          <button onclick="changeMonth(-1)">
            <i class="fas fa-arrow-left"></i>
          </button>
          <span id="calendarMonth" style="font-weight: 700; font-size: 1.15rem; color: var(--primary);"></span>
          <button onclick="changeMonth(1)">
            <i class="fas fa-arrow-right"></i>
          </button>
        </div>
        <table class="calendar-table" id="calendarTable"></table>
      </div>
    </section>

    <section id="analytics" class="section">
      <div class="widget">
        <h2>Analytics & Progress Summary</h2>
        <div class="analytics-row">
          <div class="analytics-card" id="tasksAnalytics">
            0 / 0 <span>Tasks Completed / Total</span>
          </div>
          <div class="analytics-card" id="habitAnalytics">
            0 <span>Habit Streak (Days)</span>
          </div>
          <div class="analytics-card" id="pomodoroAnalytics">
            0 <span>Pomodoros Today</span>
          </div>
          <div class="analytics-card" id="streakAnalytics">
            0 <span>Active Badges Earned</span>
          </div>
        </div>
        <p style="margin-top:1.5em; color: var(--text-soft);">
          <i class="fas fa-star" style="color: gold;"></i> Stay motivated: track your progress daily! Data is saved automatically.
        </p>
      </div>
    </section>
  </main>

  <script>
    // --- State Management: Persistence (Save/Load to localStorage) ---
    function loadState() {
      const state = localStorage.getItem('prodDashboardState');
      if (state) {
        const data = JSON.parse(state);
        // Habit Tracker
        habitProgress = data.habitProgress || new Array(habitData.length).fill(0);
        habitStreak = data.habitStreak || 0;
        // Planner/ToDo
        plannerTasks = data.plannerTasks || [];
        // Notes
        notes = data.notes || [];
        // Pomodoro
        pomodorosToday = data.pomodorosToday || 0;
        pomStats = data.pomStats || { rounds: 0, longbreaks: 0 };
        // Theme
        dark = data.darkTheme || false;
      }
      // Check for a new day to reset daily counters
      const today = new Date().toDateString();
      const lastVisit = localStorage.getItem('lastVisitDay');
      if (lastVisit !== today) {
        habitProgress = new Array(habitData.length).fill(0);
        pomodorosToday = 0;
        // Check for habit streak reset
        if (lastVisit && habitStreak > 0) {
           // We only reset streak if the last visit was yesterday and not today.
           const yesterday = new Date(new Date().setDate(new Date().getDate() - 1)).toDateString();
           if (lastVisit !== yesterday) {
             habitStreak = 0;
           }
        }
      }
      localStorage.setItem('lastVisitDay', today);
    }

    function saveState() {
      const state = {
        habitProgress: habitProgress,
        habitStreak: habitStreak,
        plannerTasks: plannerTasks,
        notes: notes,
        pomodorosToday: pomodorosToday,
        pomStats: pomStats,
        darkTheme: dark,
      };
      localStorage.setItem('prodDashboardState', JSON.stringify(state));
    }


    // ----------- Theme Switcher --------------
    let dark = false;
    function initializeTheme() {
        const savedTheme = localStorage.getItem('prodDashboardTheme');
        dark = savedTheme === 'dark';
        document.body.setAttribute('data-theme', dark ? "dark" : "");
        document.getElementById('themeSwitch').innerHTML = dark ? '<i class="fas fa-sun"></i>' : '<i class="fas fa-moon"></i>';
    }

    document.getElementById('themeSwitch').onclick = function() {
      dark = !dark;
      document.body.setAttribute('data-theme', dark ? "dark" : "");
      document.getElementById('themeSwitch').innerHTML = dark ? '<i class="fas fa-sun"></i>' : '<i class="fas fa-moon"></i>';
      localStorage.setItem('prodDashboardTheme', dark ? 'dark' : 'light');
    };

    // ---------- Sidebar Navigation -----------
    document.querySelectorAll('.sidebar button').forEach(btn => {
      btn.onclick = () => {
        document.querySelectorAll('.sidebar button').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        const sec = btn.getAttribute('data-section');
        document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
        document.getElementById(sec).classList.add('active');
      };
    });

    // ----------- Greeting & Quote ----------
    function updateGreeting() {
      const h = document.getElementById('greeting');
      const hours = new Date().getHours();
      let msg = hours < 6 ? "Good Night 🌙" : hours < 12 ? "Good Morning ☀️" : hours < 18 ? "Good Afternoon 🌤️" : "Good Evening 🌆";
      // Personalization: Using remembered name if available
      const userName = "Yeswanth";
      h.textContent = `${msg}, ${userName}!`;
    }
    updateGreeting();
    setInterval(updateGreeting, 30 * 1000);

    const quotes = [
      "Small consistent efforts create big results.",
      "Your future is created by what you do today.",
      "Code, learn, improve. Repeat.",
      "Focus on progress, not perfection.",
      "Great things never came from comfort zones.",
      "Stay curious, stay humble.",
      "Every bug is a lesson in disguise.",
      "Success is the sum of small steps."
    ];
    function updateQuote() {
      document.getElementById('quoteOfDay').textContent = quotes[new Date().getDate() % quotes.length];
    }
    updateQuote();

    // ----------- Badge Rewards -----------
    function showBadges() {
      const bar = document.getElementById('badgesBar');
      bar.innerHTML = "";
      if (habitStreak >= 3) bar.innerHTML += `<span class="badge" style="background: #E0BC59;">🔥 Streak ${habitStreak}</span>`;
      if (plannerTasks.filter(t => t.done).length >= 5) bar.innerHTML += `<span class="badge" style="background: #48BB78;">✅ Planner Pro</span>`;
      if (pomodorosToday >= 4) bar.innerHTML += `<span class="badge" style="background: #5A67D8;">⏳ Focus Master</span>`;
      if (notes.length >= 7) bar.innerHTML += `<span class="badge" style="background: #9F7AEA;">📝 Idea Collector</span>`;
      updateAnalytics();
    }

    // ----------- Weather API Widget -----------
    function fetchWeather() {
      // Mock data since real API calls won't work in online code runners
      let icons = ['<i class="fas fa-sun"></i>', '<i class="fas fa-cloud-sun"></i>', '<i class="fas fa-cloud-showers-heavy"></i>', '<i class="fas fa-bolt"></i>', '<i class="fas fa-cloud-rain"></i>', '<i class="fas fa-snowflake"></i>'];
      let weatherDescriptions = ['Sunny', 'Partly Cloudy', 'Rainy', 'Stormy', 'Showers', 'Snow'];
      let today = new Date().getDay();
      let temp = Math.floor(20 + Math.random() * 14);
      let index = today % icons.length;
      document.getElementById('weatherIcon').innerHTML = icons[index];
      document.getElementById('weatherInfo').textContent = `${temp}°C ${weatherDescriptions[index]}`;
    }
    fetchWeather();

    // ----------- Clock (Digital/Analog) -----------
    let showAnalog = false;
    function updateClock() {
      let now = new Date(), hr = now.getHours(), min = now.getMinutes(), sec = now.getSeconds();
      document.getElementById('clockDisplay').textContent = hr.toString().padStart(2, '0') + ":" + min.toString().padStart(2, '0') + ":" + sec.toString().padStart(2, '0');
      if (showAnalog) drawAnalogClock(hr, min, sec);
    }
    setInterval(updateClock, 600);

    window.toggleClock = function() {
      showAnalog = !showAnalog;
      document.getElementById('clockDisplay').style.display = showAnalog ? "none" : "block";
      document.getElementById('analogClock').style.display = showAnalog ? "block" : "none";
      document.getElementById('clockToggleButton').innerHTML = showAnalog ? '<i class="fas fa-sync-alt"></i> Analog/Digital' : '<i class="fas fa-sync-alt"></i> Digital/Analog';
      updateClock();
    }
    function drawAnalogClock(hr, min, sec) {
      let c = document.getElementById('analogClock');
      let ctx = c.getContext('2d');
      ctx.clearRect(0, 0, 106, 106);
      const center = 53, radius = 47;

      // Outer Ring
      ctx.beginPath(); ctx.arc(center, center, radius, 0, 2 * Math.PI);
      ctx.fillStyle = dark ? '#2D3748' : '#fff';
      ctx.fill();
      ctx.strokeStyle = dark ? '#63B3ED' : '#5A67D8';
      ctx.lineWidth = 3; ctx.stroke();

      // Hour Markers
      for (let i = 0; i < 12; i++) {
        let ang = Math.PI / 6 * i, x = center + 39 * Math.sin(ang), y = center - 39 * Math.cos(ang);
        ctx.beginPath(); ctx.arc(x, y, 4, 0, 2 * Math.PI);
        ctx.fillStyle = i === hr % 12 ? (dark ? '#68D391' : '#48BB78') : (dark ? '#4A5568' : '#E2E8F0');
        ctx.fill();
      }

      // Hands
      let hAng = Math.PI / 6 * (hr % 12 + min / 60), mAng = Math.PI / 30 * min, sAng = Math.PI / 30 * sec;

      // Hour hand
      ctx.strokeStyle = dark ? '#63B3ED' : '#5A67D8'; ctx.lineWidth = 7;
      ctx.beginPath(); ctx.moveTo(center, center); ctx.lineTo(center + 28 * Math.sin(hAng), center - 28 * Math.cos(hAng)); ctx.stroke();
      // Min hand
      ctx.strokeStyle = dark ? '#EDF2F7' : '#718096'; ctx.lineWidth = 5;
      ctx.beginPath(); ctx.moveTo(center, center); ctx.lineTo(center + 38 * Math.sin(mAng), center - 38 * Math.cos(mAng)); ctx.stroke();
      // Sec hand
      ctx.strokeStyle = dark ? '#68D391' : '#48BB78'; ctx.lineWidth = 2;
      ctx.beginPath(); ctx.moveTo(center, center); ctx.lineTo(center + 41 * Math.sin(sAng), center - 41 * Math.cos(sAng)); ctx.stroke();

      // Center cap
      ctx.beginPath(); ctx.arc(center, center, 6, 0, 2 * Math.PI);
      ctx.fillStyle = dark ? '#63B3ED' : '#5A67D8'; ctx.fill();
    }

    // --------- Ambient Music Player ---------
    let musicFiles = {
      'lofi': 'https://cdn.pixabay.com/audio/2022/07/26/audio_12f3b5a7b0.mp3',
      'rain': 'https://cdn.pixabay.com/audio/2022/07/26/audio_1066a5c2f2.mp3',
      'waves': 'https://cdn.pixabay.com/audio/2022/12/23/audio_12fe6dce38.mp3'
    };
    let musicPlaying = false;
    let audio = document.getElementById('musicAudio');
    let musicToggleBtn = document.getElementById('musicToggleBtn');
    let musicSelect = document.getElementById('musicSelect');

    function updateMusicSource() {
        const ms = musicSelect.value;
        audio.pause();
        if (ms === 'none') {
            audio.src = '';
            musicPlaying = false;
            musicToggleBtn.innerHTML = '<i class="fas fa-play"></i> Play';
        } else {
            audio.src = musicFiles[ms] || '';
            // If music was playing, start the new source. Otherwise, keep it paused.
            if (musicPlaying) {
                audio.play().catch(e => console.error("Audio playback failed:", e));
                musicToggleBtn.innerHTML = '<i class="fas fa-pause"></i> Pause';
            }
        }
    }

    window.toggleMusic = function() {
        const ms = musicSelect.value;
        if (ms === 'none') return;

        if (!musicPlaying) {
            audio.src = musicFiles[ms] || ''; // Ensure source is set before play
            audio.play().catch(e => {
                console.error("Audio playback failed:", e);
                alert("Playback failed. Please click anywhere on the page and try again (Browser restriction).");
            });
            musicPlaying = true;
            musicToggleBtn.innerHTML = '<i class="fas fa-pause"></i> Pause';
        } else {
            audio.pause();
            musicPlaying = false;
            musicToggleBtn.innerHTML = '<i class="fas fa-play"></i> Play';
        }
    }


    // ----------- Habit Tracker ------------
    let habitData = [
      { name: 'Code for 1hr', target: 60, unit: 'mins' },
      { name: 'DSA Practice', target: 1, unit: 'set' },
      { name: 'Read 10pgs', target: 10, unit: 'pages' },
      { name: 'Build Project', target: 1, unit: 'task' },
      { name: 'Review Notes', target: 1, unit: 'done' },
      { name: 'Exercise', target: 1, unit: 'done' },
    ];
    let habitProgress = new Array(habitData.length).fill(0);
    let habitStreak = 0; // Loaded from state

    function renderHabits() {
      let bar = document.getElementById('habitBar');
      bar.innerHTML = "";
      habitData.forEach((h, i) => {
        let current = habitProgress[i] || 0;
        let complete = current >= h.target;
        let progress = Math.min(current / h.target * 100, 100);

        bar.innerHTML += `
          <div class="habit-card">
            <h4>${h.name}</h4>
            <div class="analytics-bar" style="height: 6px; margin-top:0;">
              <div class="analytics-fill" style="width:${progress}%; background: ${complete ? 'var(--secondary)' : 'var(--primary)'}"></div>
            </div>
            <label>
              ${
                h.unit === 'done'
                ? `<input type="checkbox" ${current >= 1 ? 'checked' : ''} onchange="updateHabit(${i}, this.checked ? 1 : 0)">`
                : `<input type="number" min="0" max="${h.target}" value="${current}" onchange="updateHabit(${i},parseInt(this.value)||0)">`
              }
              <span style="font-size:.9em; color: ${complete ? 'var(--secondary)' : 'var(--text-soft)'};">
                ${h.unit === 'done' ? 'Completed' : `${current}/${h.target} ${h.unit}`}
              </span>
            </label>
          </div>
        `;
      });

      // Streak logic
      const allComplete = habitProgress.every((v, i) => v >= habitData[i].target);
      const today = new Date().toDateString();
      const lastVisit = localStorage.getItem('lastVisitDay');

      if (allComplete && lastVisit === today) {
          // Do nothing, streak continues for the day
      } else if (allComplete && lastVisit !== today) {
          // Day rollover, streak increases. (This check is handled in loadState)
      }

      showBadges();
      saveState();
    }

    window.updateHabit = function(idx, val) {
      habitProgress[idx] = val;
      renderHabits();
      updateAnalytics();
    };

    // -------- Pomodoro Timer with Analytics --------
    let timer, pomRunning = false, isBreak = false, sessionCount = 0;
    let pomTime = 25 * 60; // Default focus time
    let currentPom = pomTime;

    function getTimerDuration() {
        const study = parseInt(document.getElementById('studyTime').value) * 60 || 25 * 60;
        const short = parseInt(document.getElementById('shortBreak').value) * 60 || 5 * 60;
        const long = parseInt(document.getElementById('longBreak').value) * 60 || 15 * 60;

        if (isBreak) {
            return sessionCount % 4 === 0 && sessionCount !== 0 ? long : short;
        } else {
            return study;
        }
    }

    function showPomodoro() {
      let m = Math.floor(currentPom / 60), s = currentPom % 60;
      document.getElementById('pomodoroDisplay').textContent = m.toString().padStart(2, '0') + ":" + s.toString().padStart(2, '0');
      document.getElementById('pomFill').style.width = (100 * (pomTime - currentPom) / pomTime) + '%';
      document.getElementById('pomFill').style.background = isBreak ? 'var(--secondary)' : 'var(--primary)';
      document.getElementById('pomStats').innerHTML = `Focus rounds: ${pomodorosToday}, Next break: ${sessionCount % 4 === 0 && sessionCount !== 0 ? 'Long' : 'Short'} (${sessionCount} sessions)`;
    }

    function startPomodoro() {
      if (pomRunning) return;
      pomRunning = true;
      document.getElementById('pomodoroStartBtn').disabled = true;
      document.getElementById('pomodoroPauseBtn').disabled = false;

      // Update pomTime and currentPom to the correct duration before starting
      pomTime = getTimerDuration();
      currentPom = currentPom > 0 ? currentPom : pomTime; // If reset, use new pomTime

      timer = setInterval(() => {
        if (currentPom > 0) {
          currentPom--; showPomodoro();
        } else {
          clearInterval(timer);
          pomRunning = false;
          document.getElementById('pomodoroStartBtn').disabled = false;
          document.getElementById('pomodoroPauseBtn').disabled = true;

          let sound = new Audio("https://cdn.pixabay.com/audio/2022/08/20/audio_121e6c8dcf.mp3"); sound.play();

          if (!isBreak) {
            pomodorosToday++;
            sessionCount++;
            isBreak = true;
            pomTime = getTimerDuration(); // Calculate new break time
            currentPom = pomTime;
            alert("Pomodoro Complete! Time for a break.");
          } else {
            isBreak = false;
            pomTime = getTimerDuration(); // Calculate new focus time
            currentPom = pomTime;
            alert("Break is over! Time to focus.");
          }

          startPomodoro(); // Auto-start the next phase
        }
        updateAnalytics();
        saveState();
      }, 1000);
    }

    window.pausePomodoro = function() {
      clearInterval(timer);
      pomRunning = false;
      document.getElementById('pomodoroStartBtn').disabled = false;
      document.getElementById('pomodoroPauseBtn').disabled = true;
      saveState();
    }

    window.resetPomodoro = function() {
      clearInterval(timer);
      pomRunning = false;
      isBreak = false;
      sessionCount = 0;
      pomTime = parseInt(document.getElementById('studyTime').value) * 60 || 25 * 60;
      currentPom = pomTime;
      document.getElementById('pomodoroStartBtn').disabled = false;
      document.getElementById('pomodoroPauseBtn').disabled = true;
      showPomodoro();
      saveState();
    }
    showPomodoro();


    // ---------- Sticky Notes + Search + Autosave ----------
    let notes = []; // Loaded from state

    function renderNotes(search = "") {
      const list = document.getElementById('notesList');
      list.innerHTML = "";
      const s = search.toLowerCase();
      notes.filter(n => !s || n.title.toLowerCase().includes(s) || n.content.toLowerCase().includes(s)).forEach((note, i) => {
        list.innerHTML += `
          <li class="note">
            <span class="note-title">${note.title || 'Untitled Note'}</span>
            <span class="note-content">${note.content}</span>
            <button onclick="deleteNote(${i})"><i class="fas fa-trash-alt"></i></button>
          </li>
        `;
      });
      showBadges();
    }

    window.addNote = function() {
      const title = document.getElementById('noteTitleInput').value.trim();
      const content = document.getElementById('noteInput').value.trim();
      if (content.length > 0) {
        notes.unshift({ title: title || 'Quick Note', content });
        document.getElementById('noteTitleInput').value = "";
        document.getElementById('noteInput').value = "";
      }
      renderNotes();
      saveState();
      updateAnalytics();
    };

    window.deleteNote = function(idx) {
      notes.splice(idx, 1);
      renderNotes();
      saveState();
      updateAnalytics();
    }

    document.getElementById('noteSearch').oninput = function() { renderNotes(this.value.trim()); };


    // ------------ Daily & Weekly Planner (with Drag/Drop) -------------
    let plannerTasks = []; // Loaded from state

    function renderPlanner() {
      let list = document.getElementById('plannerList');
      list.innerHTML = "";
      plannerTasks.forEach((t, i) => {
        list.innerHTML += `<li class="planner-task${t.done ? ' completed' : ''}" draggable="true" ondragstart="dragPlanner(${i})" ondrop="dropPlanner(event, ${i})" ondragover="event.preventDefault()">
          <span class="drag-handle" title="Drag to reorder">&#9776;</span>
          <div class="task-content">
            <span>${t.text}</span>
            <small>(${t.day})</small>
          </div>
          <input type="checkbox" ${t.done ? 'checked' : ''} onchange="togglePlannerDone(${i})" style="margin-right:.7em;">
          <button class="delete" onclick="deletePlannerTask(${i})"><i class="fas fa-trash-alt"></i></button>
        </li>`;
      });
      showBadges();
    }

    window.addPlannerTask = function() {
      let v = document.getElementById('plannerTaskInput').value.trim();
      let d = document.getElementById('plannerDaySelect').value;
      if (v.length > 0) {
        plannerTasks.unshift({ text: v, day: d, done: false });
        document.getElementById('plannerTaskInput').value = "";
      }
      renderPlanner();
      saveState();
      updateAnalytics();
    };

    window.togglePlannerDone = function(idx) {
      plannerTasks[idx].done = !plannerTasks[idx].done;
      renderPlanner();
      saveState();
      updateAnalytics();
    }

    window.deletePlannerTask = function(idx) {
      plannerTasks.splice(idx, 1);
      renderPlanner();
      saveState();
      updateAnalytics();
    }

    let dragIdx = null;
    window.dragPlanner = function(idx) {
      dragIdx = idx;
      event.dataTransfer.setData("text/plain", idx);
    }

    window.dropPlanner = function(e, toIdx) {
      e.preventDefault();
      if (dragIdx !== null && toIdx !== dragIdx) {
        const item = plannerTasks.splice(dragIdx, 1)[0];
        plannerTasks.splice(toIdx, 0, item);
        renderPlanner();
        dragIdx = null;
        saveState();
      }
      updateAnalytics();
    };


    // ----------- Calendar Widget -----------
    let curMonth = new Date().getMonth(), curYear = new Date().getFullYear();

    function renderCalendar() {
      let monthNames = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
      document.getElementById('calendarMonth').textContent = monthNames[curMonth] + " " + curYear;
      let firstDay = new Date(curYear, curMonth, 1).getDay(), days = new Date(curYear, curMonth + 1, 0).getDate();
      let today = new Date();
      let html = "<tr>";
      ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"].forEach(d => html += "<th>" + d + "</th>");
      html += "</tr><tr>";
      for (let i = 0; i < firstDay; i++) html += "<td></td>";
      for (let d = 1; d <= days; d++) {
        let isToday = d === today.getDate() && curMonth === today.getMonth() && curYear === today.getFullYear();
        html += `<td class="${isToday ? 'today' : ''}" title="Day ${d}">${d}</td>`;
        firstDay++;
        if (firstDay % 7 === 0) html += "</tr><tr>";
      }
      document.getElementById('calendarTable').innerHTML = html;
    }

    window.changeMonth = function(delta) {
      curMonth += delta;
      if (curMonth < 0) { curMonth = 11; curYear--; }
      if (curMonth > 11) { curMonth = 0; curYear++; }
      renderCalendar();
    }

    // ----------- Analytics Section ----------------
    function updateAnalytics() {
      const completedTasks = plannerTasks.filter(t => t.done).length;
      document.getElementById('tasksAnalytics').innerHTML = `${completedTasks} / ${plannerTasks.length} <span>Tasks Completed / Total</span>`;
      document.getElementById('habitAnalytics').innerHTML = `${habitStreak} <span>Habit Streak (Days)</span>`;
      document.getElementById('pomodoroAnalytics').innerHTML = `${pomodorosToday} <span>Pomodoros Today</span>`;
      document.getElementById('streakAnalytics').innerHTML = `${document.getElementById('badgesBar').children.length} <span>Active Badges Earned</span>`;
      saveState(); // Ensure analytics updates save state
    }

    // --- INITIALIZE ALL ---
    initializeTheme(); // Set theme first
    loadState(); // Load saved data
    renderHabits();
    renderPlanner();
    renderNotes();
    renderCalendar();
    updateClock();
    updateAnalytics();
    showPomodoro(); // To display loaded currentPom
    showBadges(); // To display initial badges
  </script>
</body>
</html>